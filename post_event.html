<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
<title>Uzone • Post Event</title>
<style>
  :root{
    --accent:#b00b55;
    --bg:#0b0b10;
    --panel: rgba(255,255,255,.06);
    --border: rgba(255,255,255,.14);
    --text: rgba(255,255,255,.92);
    --muted: rgba(255,255,255,.70);
    --shadow: 0 20px 60px rgba(0,0,0,.45);
    --radius: 18px;
  }
  *{box-sizing:border-box}
  body{
    margin:0; min-height:100dvh;
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
    color:var(--text);
    background:
      radial-gradient(1200px 600px at 20% 10%, rgba(176,11,85,.30), transparent 60%),
      radial-gradient(900px 600px at 80% 30%, rgba(176,11,85,.18), transparent 55%),
      radial-gradient(700px 500px at 50% 90%, rgba(255,255,255,.06), transparent 60%),
      var(--bg);
  }
  header{
    width:min(1100px, 92vw);
    margin:18px auto 0 auto;
    display:flex; align-items:center; justify-content:space-between; gap:12px;
    padding:14px 16px;
    border:1px solid var(--border);
    background: linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.04));
    border-radius: var(--radius);
    box-shadow: var(--shadow);
  }
  .left{display:flex; align-items:center; gap:12px; min-width:0;}
  .left img{width:38px;height:38px;object-fit:contain; filter: drop-shadow(0 8px 16px rgba(0,0,0,.35));}
  .title{display:grid; gap:2px; min-width:0;}
  .title h1{margin:0;font-size:18px;letter-spacing:.2px}
  .title .sub{color:var(--muted);font-size:13px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
  .right{display:flex; align-items:center; gap:10px; flex-wrap:wrap; justify-content:flex-end;}
  .btn{
    padding:10px 12px;
    border-radius:12px;
    border:1px solid rgba(176,11,85,.55);
    background: linear-gradient(135deg, rgba(176,11,85,.95), rgba(176,11,85,.58));
    color:white;
    font-weight:750;
    cursor:pointer;
    box-shadow: 0 18px 40px rgba(176,11,85,.22);
    text-decoration:none;
    display:inline-flex; align-items:center; gap:8px;
    white-space:nowrap;
  }
  .btn.secondary{
    border:1px solid rgba(255,255,255,.14);
    background: rgba(0,0,0,.18);
    box-shadow:none;
    color:rgba(255,255,255,.92);
  }
  .chip{
    padding:8px 10px;
    border-radius:999px;
    border:1px solid rgba(255,255,255,.14);
    background: rgba(0,0,0,.18);
    font-size:13px;
    color:rgba(255,255,255,.85);
  }

  main{width:min(1100px, 92vw); margin:16px auto 30px auto; display:grid; gap:14px;}
  .card{
    border:1px solid var(--border);
    background: linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.04));
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    padding:14px;
  }
  .row{display:grid; grid-template-columns: 1fr 1fr; gap:12px;}
  @media (max-width: 820px){ .row{grid-template-columns:1fr;} }

  label{display:grid; gap:6px; font-size:13px; color:rgba(255,255,255,.78);}
  input, textarea, select{
    width:100%;
    padding:12px 12px;
    border-radius:12px;
    border:1px solid rgba(255,255,255,.14);
    background: rgba(255,255,255,.06);
    color:var(--text);
    outline:none;
    font-size:14px;
  }
  textarea{min-height:100px; resize:vertical}
  input:focus, textarea:focus, select:focus{
    border-color: rgba(176,11,85,.60);
    box-shadow: 0 0 0 4px rgba(176,11,85,.20);
  }
  .toggle{
    display:flex; align-items:center; gap:10px;
    padding:10px 12px;
    border-radius:12px;
    border:1px solid rgba(255,255,255,.14);
    background: rgba(0,0,0,.18);
    width:fit-content;
  }
  .msg{display:none; padding:10px 12px; border-radius:12px; border:1px solid rgba(255,255,255,.14); background: rgba(0,0,0,.16); color:rgba(255,255,255,.85); font-size:13px; white-space:pre-line;}
  .msg.ok{border-color: rgba(80,255,160,.25); background: rgba(80,255,160,.10);}
  .msg.error{border-color: rgba(255,80,120,.30); background: rgba(255,80,120,.10);}
</style>
</head>
<body>
<header>
  <div class="left">
    <img src="logo.png" alt="Uzone logo" />
    <div class="title">
      <h1>Post Event</h1>
      <div class="sub">Create something people actually want to go to</div>
    </div>
  </div>
  <div class="right">
    <a class="btn secondary" href="events.html">← Events</a>
    <a class="btn secondary" href="my_events.html">My Events</a>
    <a class="btn secondary" href="hub.html">Hub</a>
    <span class="chip" id="userEmail">—</span>
  </div>
</header>

<main>
  <section class="card">
    <div class="row">
      <label>Event Name
        <input id="name" placeholder="e.g., Rooftop Chill Night" />
      </label>
      <label>Location
        <input id="location" placeholder="e.g., 123 King St (or 'Near campus')" />
      </label>
    </div>

    <div class="row" style="margin-top:12px;">
      <label>Date
        <input id="date" placeholder="e.g., 2026-02-22" />
      </label>
      <label>Time
        <input id="time" placeholder="e.g., 9:00 PM" />
      </label>
    </div>

    <div class="row" style="margin-top:12px;">
      <label>Size estimate (# of people)
        <input id="size" type="number" min="1" placeholder="e.g., 20" />
      </label>
      <label>Ratio (guys to girls)
        <input id="ratio" placeholder="e.g., 50/50 or 60/40" />
      </label>
    </div>

    <div class="row" style="margin-top:12px;">
      <label>Vibes
        <input id="vibes" placeholder="e.g., chill, music, games, social" />
      </label>
      <label>Tags (comma separated)
        <input id="tags" placeholder="e.g., no alcohol, music, chill" />
      </label>
    </div>

    <div class="row" style="margin-top:12px;">
      <label>Event bio
        <textarea id="bio" placeholder="Describe the event…"></textarea>
      </label>
      <div>
        <label>Event image (URL)
          <input id="imageUrl" placeholder="https://…" />
        </label>
        <div class="toggle" style="margin-top:10px;">
          <input id="inviteOnly" type="checkbox" />
          <label for="inviteOnly" style="margin:0; color:rgba(255,255,255,.85);">Invite-only</label>
        </div>
        <div style="color:rgba(255,255,255,.68); font-size:12px; line-height:1.35; margin-top:10px;">
          Invite-only events hide the exact date/time/location until the host accepts applicants.
        </div>
      </div>
    </div>

    <div style="display:flex; justify-content:flex-end; gap:10px; flex-wrap:wrap; margin-top:14px;">
      <button class="btn" id="postBtn" type="button">Post Event</button>
    </div>

    <div class="msg" id="msg"></div>
  </section>
</main>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";
import { getFirestore, collection, addDoc, serverTimestamp, doc, getDoc } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyD_k18vbiBsLhQB7PzgEVT9PEI_30Mu0kg",
  authDomain: "uzone-6148d.firebaseapp.com",
  projectId: "uzone-6148d",
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const userEmail = document.getElementById("userEmail");
const msg = document.getElementById("msg");
const postBtn = document.getElementById("postBtn");

const nameEl = document.getElementById("name");
const locationEl = document.getElementById("location");
const dateEl = document.getElementById("date");
const timeEl = document.getElementById("time");
const sizeEl = document.getElementById("size");
const ratioEl = document.getElementById("ratio");
const vibesEl = document.getElementById("vibes");
const tagsEl = document.getElementById("tags");
const bioEl = document.getElementById("bio");
const imageEl = document.getElementById("imageUrl");
const inviteEl = document.getElementById("inviteOnly");

let currentUser = null;

function setMsg(text, kind=""){
  msg.style.display = text ? "block" : "none";
  msg.textContent = text || "";
  msg.className = "msg" + (kind ? " " + kind : "");
}

onAuthStateChanged(auth, async (user)=>{
  if (!user) { window.location.href="index.html"; return; }
  currentUser = user;
  userEmail.textContent = user.email || "Signed in";
});

postBtn.addEventListener("click", async ()=>{
  if (!currentUser) return;

  const name = (nameEl.value||"").trim();
  if (!name) { setMsg("Please enter an event name.", "error"); return; }

  postBtn.disabled = true;
  setMsg("");

  try{
    // Pull host name from users collection if available
    let hostName = currentUser.displayName || "";
    try{
      const u = await getDoc(doc(db,"users",currentUser.uid));
      if (u.exists() && u.data()?.name) hostName = u.data().name;
    } catch(_) {}

    const tags = (tagsEl.value||"")
      .split(",")
      .map(s=>s.trim())
      .filter(Boolean)
      .slice(0, 12);

    const sizeEstimate = Number(sizeEl.value || 0) || 0;

    const eventDoc = await addDoc(collection(db,"events"), {
      name,
      location: (locationEl.value||"").trim(),
      date: (dateEl.value||"").trim(),
      time: (timeEl.value||"").trim(),
      sizeEstimate,
      vibes: (vibesEl.value||"").trim(),
      ratio: (ratioEl.value||"").trim(),
      bio: (bioEl.value||"").trim(),
      tags,
      imageUrl: (imageEl.value||"").trim(),
      inviteOnly: !!inviteEl.checked,
      ratingAvg: 0,
      hostUid: currentUser.uid,
      hostName: hostName || currentUser.email || "Host",
      createdAt: serverTimestamp()
    });

    setMsg("Event posted!", "ok");
    setTimeout(()=>{ window.location.href = `event.html?id=${encodeURIComponent(eventDoc.id)}`; }, 600);
  } catch(e){
    setMsg(e.message || "Failed to post event.", "error");
  } finally {
    postBtn.disabled = false;
  }
});
</script>
</body>
</html>
